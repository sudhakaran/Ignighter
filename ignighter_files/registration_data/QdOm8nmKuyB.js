/*1303151240,169775813*/

if (window.CavalryLogger) { CavalryLogger.start_js(["S5qqy"]); }

function Poller(b,a){this.setTimePeriod(b);this._requestCallback=a;this.scheduleRequest();}Poller.MIN_TIME_PERIOD=2000;copy_properties(Poller.prototype,{stop:function(){clearTimeout(this._token);this._token=null;this._cancelRequest();},scheduleRequest:function(){this.stop();if(this._timePeriod)this._token=this._makeRequest.bind(this).defer(this._timePeriod);},requestNow:function(){this.stop();this._makeRequest();},_timePeriod:null,setTimePeriod:function(a){a=a||null;if(a&&(isNaN(a)||a<Poller.MIN_TIME_PERIOD))return;this._timePeriod=a;},_makeRequest:function(){this._cancelRequest();if(!this._isLoadUser())return;var b=new AsyncRequest();var a=true;b.setInitialHandler(function(){return a;});this._cancelRequest=function(){a=false;};b.setFinallyHandler(this.scheduleRequest.bind(this));b.setInitialHandler=bagofholding;b.setFinallyHandler=bagofholding;this._requestCallback(b);if(a)b.send();},_isLoadUser:function(){return Env.user==getCookie('c_user');},_cancelRequest:bagofholding,getTimePeriod:function(){return this._timePeriod;}});
var ChatUserInfos=window.ChatUserInfos||{};
var FriendLists=window.FriendLists||{get:function(a){var b=FriendLists._map;if(!b[a])b[a]=[];return b[a];},set:function(a,b){if(b===undefined)return;var c=FriendLists.get(a);c.length=0;c.push.apply(c,$A(b));},_map:{}};
var AvailableList=window.AvailableList||(function(){var a=5;var c=60000;var d='/ajax/chat/buddy_list.php';var b=5000;var z=0;var zf=false;var q=0;var y=false;var v=null;var o=null;var i=null;var n=0;var h=null;var w={};var t={};var u={};var p={'0':2,'1':1,'-1':0};var za={0:-1,1:1,2:0};function l(){return Chat.isOnline()?(zf?v:o):null;}function f(zh,zj,zi){if(zh==Env.user)return;if(AvailableList.get(zh)==zj)return;switch(zj){case AvailableList.OFFLINE:case AvailableList.IDLE:case AvailableList.ACTIVE:break;default:return;}if(zi){t[zh]=zj;u[zh]=presence.getTime()+c;}else w[zh]=zj;z++;if(!i)i=zb.defer();}function zd(zh){h=zh;Arbiter.inform('buddylist/count-changed',zh);}function zc(zh){if(presence.isShutdown||!Chat.isOnline()){AvailableList._poller.stop();return;}n=new Date();y=true;zh.setHandler(s).setErrorHandler(r).setTransportErrorHandler(r).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:Env.user,popped_out:presence.poppedOut,available_list:AvailableList.haveFullList?k():{},force_render:zf}).setURI(d).setAllowCrossPageTransition(true);}function s(zk){var zj=zk.getPayload();var zh=zj.buddy_list;if(!zh){r(zk);return;}presence.updateServerTime(zj.time);AvailableList.updateTime=presence.getTime();q=0;y=false;if(zh.forcedRender)AvailableList.haveFullList=true;if(zh.availableCount)zd(zh.availableCount);var zl=zh.userInfos;if(zl)copy_properties(ChatUserInfos,zl);if(zh.wasAvailableIDs)zh.wasAvailableIDs.forEach(function(zm){w[zm]=AvailableList.OFFLINE;});var zi=zh.nowAvailableList;zi&&AvailableList.addLegacyAvailableList(zi);zg();Arbiter.inform('buddylist/fl-changed',{flMode:zh.flMode,flData:zh.flData});presenceCookieManager.store();}function r(zh){if(presence.checkMaintenanceError(zh))return;q++;y=false;if(q>=a){zd(0);Arbiter.inform('buddylist/update-error');}}function k(){var zh={};AvailableList.getAvailableIDs().forEach(function(zi){zh[zi]={i:AvailableList.isIdle(zi)?1:0};});return zh;}function zg(){if(AvailableList.haveFullList)Arbiter.inform('buddylist/updated');}function zb(){i=null;if(AvailableList.haveFullList)zd(AvailableList.getAvailableIDs().length);Arbiter.inform('buddylist/availability-changed');}function g(zh,zj){for(var zi in zh){var zk;if(zj){zk=p[zh[zi].ol];}else zk=zh[zi]?(zh[zi].i?AvailableList.IDLE:AvailableList.ACTIVE):0;f(zi,zk,zj);zh[zi]&&zh[zi].fl&&FriendLists.set(zi,zh[zi].fl);}}function m(){ze();if(Chat.isOnline()){AvailableList.update();}else e();}function e(){AvailableList.haveFullList=false;w={};t={};u={};zb();}function ze(){AvailableList._poller&&AvailableList._poller.setTimePeriod(l());}function j(){var zh={};Chat.getActiveChats().forEach(function(zl){var zk=AvailableList.get(zl);if(zk)zh[zl]={i:zk==AvailableList.IDLE?1:0};});var zi={ac:h,ut:parseInt(AvailableList.updateTime*.001,10),ud:v*.001,lc:0};var zj=AvailableList.getLegacyOverlay();if(!is_empty(zj))zi.uo=zj;if(!is_empty(zh))zi.al=zh;return zi;}function x(){for(var zh in t)if(u[zh]<presence.getTime()){delete t[zh];delete u[zh];}}return {OFFLINE:0,IDLE:1,ACTIVE:2,haveFullList:false,init:function(zn,zj,zm,zl,zk,zh,zi){AvailableList.updateTime=zn;AvailableList.haveFullList=zj;AvailableList.addLegacyAvailableList(zh);AvailableList.addLegacyOverlay(zm);v=zl;o=zk;AvailableList._poller=new Poller(l(),zc);zd(zi);Arbiter.subscribe('presence/restarted',AvailableList.update);Arbiter.subscribe('chat/visibility-changed',m);Arbiter.subscribe('presence-cookie-manager/initialized',function(zo,zp){zp.register('bl',j);});if(AvailableList.haveFullList){n=new Date();}else if(zf)AvailableList.update();},get:function(zh){if(zh==Env.user)return AvailableList.ACTIVE;if(zh in t&&presence.getTime()<u[zh])return t[zh];return w[zh]||AvailableList.OFFLINE;},isReady:function(){return AvailableList.haveFullList;},set:function(zi,zj,zh){zh&&FriendLists.set(zi,$A(zh));f(zi,zj,true);window.presence&&presence.doSync();},update:function(){if(new Date()-n<b){!y&&zg.defer();return;}zf=true;ze();AvailableList._poller&&AvailableList._poller.requestNow();},getRev:function(){return z;},isIdle:function(zh){return AvailableList.get(zh)==AvailableList.IDLE;},getCount:function(){return h;},getAvailableIDs:function(){var zh,zi=[];for(zh in w)if(AvailableList.get(zh))zi.push(zh);for(zh in t){if(zh in w)continue;if(AvailableList.get(zh))zi.push(zh);}return zi;},getLegacyOverlay:function(){x();var zi={};for(var zh in t)zi[zh]={exp:u[zh],fl:FriendLists.get(zh),ol:za[t[zh]]};return zi;},addLegacyOverlay:function(zh){g(zh,true);},addLegacyAvailableList:function(zh){g(zh,false);}};})();
if(!window.Chat){var Chat={openTab:function(a,b,c){Chat._withComponent('chatDisplay',function(d){d.focusTab(a,true,b,b,c);});},loadTabFragile:function(b,c,a,d){Chat._withComponent('chatDisplay',function(e){e.loadTabFragile(b,c,a,d);});},openBuddyList:function(){Chat._withComponent('buddyListNub',function(a){a.show();});},closeBuddyList:function(){Chat._withComponent('buddyListNub',function(a){a.hide();});},goOnline:function(a){Arbiter.subscribe('chat-options/initialized',function(event,b){if(Chat.isOnline()){a&&a();}else{if(a)var c=Arbiter.subscribe('chat/visibility-changed',function(){Arbiter.unsubscribe(c);a();});b.sendVisibility(true);}});},isOnline:function(){return window.chatOptions&&chatOptions.visibility;},squelchTab:function(a,b){Chat._withComponent('chatDisplay',function(c){b!==false&&c.unfocus(a,false);c.setSquelchedTab(a,true);});},unsquelchTab:function(a){Chat._withComponent('chatDisplay',function(b){b.setSquelchedTab(a,false);});},enterErrorMode:function(a){Chat._withComponent('buddyList',function(b){b.enterErrorMode(a);});},getActiveChats:function(){if(!window.chatDisplay)return [];return keys(chatDisplay.tabs);},isFeatureAvailable:function(a){return window.chatDisplay&&a in chatDisplay.gatedFeatures&&chatDisplay.gatedFeatures[a];},_componentInitEvents:{buddyList:'buddylist/initialized',chatDisplay:'chat-display/loaded',buddyListDisplay:'buddylist-display/initialized',buddyListNub:'buddylist-nub/initialized'},_withComponent:function(b,a){Arbiter.subscribe(Chat._componentInitEvents[b],function(event,c){a(c);});}};Chat._withComponent("buddyList",function(a){Chat._buddyList=a;});copy_properties(Chat,{debugPrintUpdateOverlay:function(){Chat._withComponent('buddyList',function(a){a.debugPrintUpdateOverlay();});},updateUserInfo:function(a){Chat._buddyList&&Chat._buddyList.updateUserInfos(a);},setUserInfo:function(b,c,a){ChatUserInfos[b]=c;Chat._withComponent('buddyList',function(d){d.updateItemDisplay(b);a&&FriendLists.set(b,a);});}});}
var NavigationMessage={NAVIGATION_BEGIN:'NavigationMessage/navigationBegin',NAVIGATION_SELECT:'NavigationMessage/navigationSelect',NAVIGATION_COMPLETED:'NavigationMessage/navigationCompleted',NAVIGATION_FAILED:'NavigationMessage/navigationFailed',NAVIGATION_COUNT_UPDATE:'NavigationMessage/navigationCount',REFRESH_RIGHT_COLUMN:'NavigationMessage/refreshRightColumn',PREFETCH:'NavigationMessage/prefetch',INTERNAL_LOADING_BEGIN:'NavigationMessage/internalLoadingBegin',INTERNAL_LOADING_COMPLETED:'NavigationMessage/internalLoadingCompleted'};
add_properties('Hovercard',{active:{},init:function(){if(ua.ie()<7)return;Event.listen(document.documentElement,'mouseover',this.handle.bind(this));},handle:function(event){var a=Parent.byTag(event.getTarget(),'a');if((a||!this.isShowing)&&this.setActive(a)){(this.process||this.bootload).call(this,a);event.stop();}},bootload:function(a){this.bootload=bagofholding;Bootloader.loadComponents(['hovercard-core'],function(){if(a==this.active.node)this.process(a);}.bind(this));},getEndpoint:function(a){return a.getAttribute('data-hovercard');},isActive:function(a){return a&&this.isShowing&&this.active.node==a;},setActive:function(b){if(!this.isActive(b)){var a;if(!b||!(a=this.getEndpoint(b))){this.active={};return false;}if(this.active.node!=b){this.active.moveToken&&this.active.moveToken.remove();this.active={node:b,endpoint:a,pos:null};}}return true;}});onloadRegister(Hovercard.init.bind(Hovercard));
function adjustImage(e,g){if(!g){var a=e.parentNode;while(a.parentNode&&(CSS.getStyle(a,'display')!='block'||a.offsetWidth==0))a=a.parentNode;g=a.offsetWidth;}var c=e.offsetWidth;if(c==0){var d=e.nextSibling,f=e.parentNode;document.body.appendChild(e);c=e.offsetWidth;if(d){f.insertBefore(e,d);}else f.appendChild(e);}if(c>g)try{if(ua.ie()<8){var img_div=document.createElement('div');img_div.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+e.src.replace('"','%22')+'", sizingMethod="scale")';img_div.style.width=g+'px';img_div.style.height=Math.floor(((g/e.offsetWidth)*e.offsetHeight))+'px';if(e.parentNode.tagName=='A')img_div.style.cursor='pointer';e.parentNode.insertBefore(img_div,e);e.parentNode.removeChild(e);}else throw 1;}catch(b){e.style.width=g+'px';}CSS.removeClass(e,'img_loading');}function imageConstrainSize(e,b,c,d){var a=new Image();a.onload=function(){if(a.width>0&&a.height>0){var k=a.width;var h=a.height;if(k>b||h>c){var g=c/b;var f=h/k;if(f>g){k=k*(c/h);h=c;}else{h=h*(b/k);k=b;}}var j=ge(d);if(j){var i=document.createElement('img');i.src=e;i.width=k;i.height=h;j.parentNode.insertBefore(i,j);j.parentNode.removeChild(j);}}};a.src=e;}function image_has_loaded(a){if(a.naturalWidth!==undefined){return a.complete&&a.width!=0;}else if(a.height==20&&a.width==20&&a.complete){return false;}else if(a.complete===undefined&&ua.safari()<500){var b=new Image();b.src=a.src;return b.complete;}return a.complete;}function image_has_failed(a){if((a.complete==null&&a.width==20&&a.height==20)||(a.mimeType!=null&&a.complete&&a.mimeType=='')||(a.naturalHeight!=null&&a.complete&&a.naturalHeight==0))return true;}
var FormControl={_gettingCaretPosition:false,getCaretPosition:function(a){a=$(a);if(!DOM.isNode(a,['input','textarea']))return {start:undefined,end:undefined};if(!document.selection)return {start:a.selectionStart,end:a.selectionEnd};if(DOM.isNode(a,'input')){var c=document.selection.createRange();return {start:-c.moveStart('character',-a.value.length),end:-c.moveEnd('character',-a.value.length)};}else{if(!this._gettingCaretPosition){this._gettingCaretPosition=true;a.focus();this._gettingCaretPosition=false;}var c=document.selection.createRange();var d=c.duplicate();d.moveToElementText(a);d.setEndPoint('StartToEnd',c);var b=a.value.length-d.text.length;d.setEndPoint('StartToStart',c);return {start:a.value.length-d.text.length,end:b};}},setCaretPosition:function(c,f,a){c=$(c);if(document.selection){if(c.tagName=='TEXTAREA'){var b=c.value.indexOf("\r",0);while(b!=-1&&b<a){a--;if(b<f)f--;b=c.value.indexOf("\r",b+1);}}var d=c.createTextRange();d.collapse(true);d.moveStart('character',f);if(a!=undefined)d.moveEnd('character',a-f);d.select();}else{c.selectionStart=f;var e=a==undefined?f:a;c.selectionEnd=Math.min(e,c.value.length);c.focus();}}};
function TextInputControl(b){this.parent.construct(this,b);var a=this.getRoot();this.maxLength=a.maxLength||null;var c=function(){this.update.bind(this).defer();}.bind(this);Event.listen(a,{keydown:c,paste:c});}TextInputControl.extend('DOMControl');TextInputControl.prototype={setMaxLength:function(a){var b=this.getRoot();this.maxLength=a;if(a){b.maxLength=a;}else b.removeAttribute('maxlength');return this;},getValue:function(){return Input.getValue(this.getRoot());},isEmpty:function(){return Input.isEmpty(this.getRoot());},setValue:function(a){this.getRoot().value=a;this.update();return this;},clear:function(){return this.setValue('');},setPlaceholderText:function(a){Input.setPlaceholder(this.getRoot(),a);},onupdate:function(){var d=this.getRoot();if(this.maxLength>0)if(d.value.length>this.maxLength){var e=d.value;var c=e.length-this.maxLength;var a=FormControl.getCaretPosition(d);var b=a.end||e.length;d.value=e.substring(0,b-c)+e.substring(b);if(typeof a.start!='undefined')FormControl.setCaretPosition(d,a.start-c,Math.max(a.start,a.end)-c);}}};
function TextAreaControl(a){this.autogrow=false;this.parent.construct(this,a);this.width=null;Event.listen(a,{focus:this._handleFocus.bind(this)});}TextAreaControl.extend('TextInputControl');TextAreaControl.getWidth=function(b){var a=function(d){return parseInt(CSS.getStyle(b,d),10);};var c=b.offsetWidth-a('paddingLeft')-a('paddingRight')-a('borderLeftWidth')-a('borderRightWidth');if(ua.firefox())c-=2;return Math.max(c,0);};TextAreaControl.prototype={setAutogrow:function(a){this.autogrow=a;return this;},onupdate:function(){this.parent.onupdate();if(this.autogrow){var b=this.getRoot();var c=this.getShadow(b);if(!c)return;CSS.setStyle(c,'width',this._getWidth()+'px');DOM.setContent(c,HTML(htmlize(b.value)+'...'));var a=Math.max(this.minHeight,c.offsetHeight);if(a!=this.height){CSS.setStyle(b,'height',this.isEmpty()?'':a+'px');this.height=a;Arbiter.inform('reflow');}}else if(this.shadow){DOM.remove(this.shadow);this.shadow=null;}},_getWidth:function(){if(this.width===null)this.width=TextAreaControl.getWidth(this.getRoot());return this.width;},getShadow:function(c){if(!this.shadow){var a=CSS.getStyle(c,'fontSize');if(!a)return false;var b=parseInt(CSS.getStyle(c,'height'),10);this.minHeight=b>0?b:c.offsetHeight-8;this.shadow=$N('div',{className:'DOMControl_shadow',style:{wordWrap:'break-word',fontSize:a,fontFamily:CSS.getStyle(c,'fontFamily')}});DOM.getRootElement().appendChild(this.shadow);}return this.shadow;},resetHeight:function(){this.height=-1;this.update();},_handleFocus:function(){this.width=null;}};
var DOMScroll={getScrollState:function(){var d=Vector2.getViewportDimensions();var a=Vector2.getDocumentDimensions();var b=(a.x>d.x);var c=(a.y>d.y);b+=0;c+=0;return new Vector2(b,c);},_scrollbarSize:null,_initScrollbarSize:function(){var a=$N('p');a.style.width='100%';a.style.height='200px';var b=$N('div');b.style.position='absolute';b.style.top='0px';b.style.left='0px';b.style.visibility='hidden';b.style.width='200px';b.style.height='150px';b.style.overflow='hidden';b.appendChild(a);document.body.appendChild(b);var c=a.offsetWidth;b.style.overflow='scroll';var d=a.offsetWidth;if(c==d)d=b.clientWidth;document.body.removeChild(b);DOMScroll._scrollbarSize=c-d;if(DOMScroll._scrollbarSize<5)DOMScroll._scrollbarSize=15;},getScrollbarSize:function(){if(DOMScroll._scrollbarSize===null)DOMScroll._initScrollbarSize();return DOMScroll._scrollbarSize;},scrollTo:function(d,a,c,b){if(typeof a=='undefined'||a===true)a=750;if(!(d instanceof Vector2)){var e=Vector2.getScrollPosition().x;var f=Vector2.getElementPosition($(d)).y;f=f-Math.min(0,Math.max(Vector2.getViewportDimensions().y/3,100));d=new Vector2(e,f,'document');}if(c){d.y-=Vector2.getViewportDimensions().y/2;}else if(b){d.y-=Vector2.getViewportDimensions().y;d.y+=b;}d=d.convertTo('document');if(a){Bootloader.loadComponents('animation',function(){var g=document.body;animation(g).to('scrollTop',d.y).to('scrollLeft',d.x).ease(animation.ease.end).duration(a).go();});}else if(window.scrollTo)window.scrollTo(d.x,d.y);}};
function ElementController(){this.handlers=[[],[]];}copy_properties(ElementController,{ALL:1,TARGETS:2,MODIFIERS:4,BUTTONS:8});ElementController.prototype={initialize:function(){this.initialize=bagofholding;onloadRegister(this.register.bind(this));},handle:function(e,event,a){a=a||bagof(true);var b=this.handlers[0].concat(this.handlers[1]);for(var c=0,d=b.length;c<d;c++)if(a(b[c].filters,e,event)&&b[c].callback(e,event)===false)return event.kill();},_registerHandler:function(b,a,c,d){this.initialize();b[d?'unshift':'push']({callback:a,filters:c||0});},registerHandler:function(a,b,c){this._registerHandler(this.handlers[0],a,b,c);},registerFallbackHandler:function(a,b,c){this._registerHandler(this.handlers[1],a,b,c);}};var LinkController=new ElementController();copy_properties(LinkController,{key:'LinkControllerHandler',register:function(){Event.listen(document.documentElement,'mousedown',this.handler.bind(this));Event.listen(document.documentElement,'keydown',this.handler.bind(this));},handler:function(event){var b=Parent.byTag(event.getTarget(),'a');var a=b&&b.getAttribute('href',2);if(!a||b.rel||!this.usesWebProtocol(a)||DataStore.get(b,this.key))return;DataStore.set(b,this.key,Event.listen(b,'click',function(event){if(a.charAt(a.length-1)=='#'){event.prevent();return;}this.handle(b,event,this.filter);}.bind(this)));},filter:function(a,b,event){if(a&ElementController.ALL)return true;if((!(a&ElementController.TARGETS)&&b.target)||(!(a&ElementController.MODIFIERS)&&event.getModifiers().any)||(!(a&ElementController.BUTTONS)&&ua.safari()>=525&&event.which!=1))return false;return true;},usesWebProtocol:function(a){var b=a.match(/^(\w+):/);return !b||b[1].match(/^http/i);}});var FormController=new ElementController();copy_properties(FormController,{register:function(){Event.listen(document.documentElement,'submit',this.handler.bind(this));},handler:function(event){user_action(event.getTarget(),'form',event);return this.handle(event.getTarget(),event);}});
function URLScraper(a){this.input=a;this.enable();}URLScraper.mixin('Arbiter',{reset:function(){this.lastMatch=null;},enable:function(){if(this.events)return;var a=function(b){setTimeout(this.check.bind(this,b),30);};this.events=Event.listen(this.input,{paste:a.bind(this,false),keydown:a.bind(this,true)});},disable:function(){if(!this.events)return;for(var event in this.events)this.events[event].remove();this.events=null;},check:function(b){var c=this.input.value;if(b&&URLScraper.trigger(c))return;var a=URLScraper.match(c);if(a&&a!=this.lastMatch){this.lastMatch=a;this.inform('match',{url:a});}}});(function(){var c='[a-z][a-z0-9\\-+.]+://',h='www\\d{0,3}[.]',b='[a-z0-9.\\-]+[.][a-z]{2,4}\\/',a='\\([^\\s()<>]+\\)',f='[^\\s()<>]+',e='[^\\s`!()\\[\\]{};:\'".,<>?]';var d=new RegExp('\\b('+'(?:'+c+'|'+h+'|'+b+')'+'(?:'+a+'|'+f+')*'+'(?:'+a+'|'+e+')'+')','im');var g=/[\s'"!;,)]/;URLScraper.match=function(i){return (d.exec(i)||[])[1]||null;};URLScraper.trigger=function(i){return !g.test(i.charAt(i.length-1));};})();
function rand32(){return Math.floor(Math.random()*4294967295);}function verifyNumber(a){if(typeof a=='undefined'||isNaN(a)||a==Number.POSITIVE_INFINITY||a==Number.NEGATIVE_INFINITY)a=0;return a;}
function html_hyperlink(g,h,i,e){if(typeof g==='undefined'||!g.toString)return '';if(typeof h!=='function')h=htmlize;if(typeof i!=='function')i=htmlize;var g=g.toString();var f=[];var b;while((b=URLScraper.match(g))){var d=g.indexOf(b);if(d>=0)f.push(h(g.substring(0,d)));var a=i(b);var c=b.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(b)))c='http://'+c;f.push('<a target="_blank" rel="nofollow" href="'+c+'"');if(e)f.push(' onmousedown="UntrustedLink.bootstrap(this, \''+Env.lhsh+'\', event)"');f.push('>'+a+'</a>');g=g.substring(d+b.length);}g&&f.push(h(g));return f.join('');}function nl2br(a){if(typeof(a)=='undefined'||!a.toString)return '';return a.toString().replace(/\n/g,'<br />');}function is_email(a){return /^([\w!.%+\-])+@([\w\-])+(?:\.[\w\-]+)+$/.test(a);}
var DocumentTitle=(function(g){var a=1500;var f=[];var e=0;var c=null;var d=true;function b(){if(f.length>0){if(d){DocumentTitle.set(f[e].title,true);e=++e%f.length;d=false;}else DocumentTitle.reset();}else{clearInterval(c);c=null;DocumentTitle.reset();}}return {get:function(){return g;},set:function(h,i){document.title=h;if(!i){g=h;Arbiter.inform('update_title',h);}},reset:function(){DocumentTitle.set(DocumentTitle.get(),true);d=true;},blink:function(i){var h={title:i};f.push(h);if(c===null)c=b.recur(a);return {stop:function(){var j=f.indexOf(h);if(j>=0){f.splice(j,1);if(e>j)e--;}}};}};})(document.title);
function XHPTemplate(a){this.model=a;}XHPTemplate.prototype={render:function(){if(HTML.isHTML(this.model))this.model=DOM.setContent(document.createDocumentFragment(),this.model)[0];return this.model.cloneNode(true);}};(function(){var a='XHPTemplate:nodes';copy_properties(XHPTemplate,{getNode:function(c,b){return XHPTemplate.getNodes(c)[b];},getNodes:function(e){var d=DataStore.get(e,a);if(!d){d={};var f=DOM.scry(e,'[data-jsid]');f.push(e);var b=f.length;while(b--){var c=f[b];d[c.getAttribute('data-jsid')]=c;c.removeAttribute('data-jsid');}DataStore.set(e,a,d);}return d;}});})();
function AjaxPipeRequest(b,a){this._uri=b;this._query_data=a;this._request=new AsyncRequest();this._canvas_id=null;this._allow_cross_page_transition=true;this._replayable=false;}copy_properties(AjaxPipeRequest.prototype,{setCanvasId:function(a){this._canvas_id=a;return this;},setURI:function(a){this._uri=a;return this;},setData:function(a){this._query_data=a;return this;},getData:function(a){return this._query_data;},setAllowCrossPageTransition:function(a){this._allow_cross_page_transition=a;return this;},setAppend:function(a){this._append=a;return this;},send:function(){this._request.setOption('useIframeTransport',true).setURI(this._uri).setData(copy_properties({ajaxpipe:1},this._query_data)).setPreBootloadHandler(this._preBootloadHandler.bind(this)).setInitialHandler(this._onInitialResponse.bind(this)).setHandler(this._onResponse.bind(this)).setReplayable(this._replayable).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(this._allow_cross_page_transition);AjaxPipeRequest._current_request=this._request;this._request.send();return this;},_preBootloadFirstResponse:function(a){return false;},_fireDomContentCallback:function(){this._arbiter.inform('ajaxpipe/domcontent_callback',true,Arbiter.BEHAVIOR_STATE);},_fireOnloadCallback:function(){this._arbiter.inform('ajaxpipe/onload_callback',true,Arbiter.BEHAVIOR_STATE);},_isRelevant:function(a){return this._request==AjaxPipeRequest._current_request||a.isReplay()||this._jsNonBlock;},_preBootloadHandler:function(b){var a=b.getPayload();if(!a||a.redirect||!this._isRelevant(b))return false;var c=false;if(b.is_first){!this._append&&AjaxPipeRequest.clearCanvas(this._canvas_id);this._arbiter=new Arbiter();c=this._preBootloadFirstResponse(b);this._arbiter.registerCallback(function(){this._onUIpageOnload&&this._onUIpageOnload();}.bind(this),['uipage_onload']);this.pipe=new BigPipe({arbiter:this._arbiter,rootNodeID:this._canvas_id,lid:this._request.lid,rrEnabled:b.payload.roadrunner_enabled,isAjax:true,domContentCallback:this._fireDomContentCallback.bind(this),onloadCallback:this._fireOnloadCallback.bind(this),domContentEvt:'ajaxpipe/domcontent_callback',onloadEvt:'ajaxpipe/onload_callback',isReplay:b.isReplay(),jsNonBlock:this._jsNonBlock});}return c;},_redirect:function(a){return false;},_versionCheck:function(a){return true;},_onInitialResponse:function(b){var a=b.getPayload();if(!this._isRelevant(b))return false;if(!a)return true;if(this._redirect(a)||!this._versionCheck(a))return false;return true;},_processFirstResponse:function(b){var a=b.getPayload();if(ge(this._canvas_id)&&a.canvas_class!==null)CSS.setClass(this._canvas_id,a.canvas_class);},setFirstResponseHandler:function(a){this._processFirstResponse=a;return this;},_onResponse:function(b){var a=b.payload;if(!this._isRelevant(b))return AsyncRequest.suppressOnloadToken;if(b.is_first){this._processFirstResponse(b);a.provides=a.provides||[];a.provides.push('uipage_onload');if(this._append)a.append=this._canvas_id;}if(a){if('content' in a.content&&this._canvas_id!==null&&this._canvas_id!='content'){a.content[this._canvas_id]=a.content.content;delete a.content.content;}this.pipe.onPageletArrive(a);}if(b.is_last)AjaxPipeRequest.restoreCanvas(this._canvas_id);return AsyncRequest.suppressOnloadToken;},setFinallyHandler:function(a){this._request.setFinallyHandler(a);return this;},setErrorHandler:function(a){this._request.setErrorHandler(a);return this;},abort:function(){this._request.abort();if(AjaxPipeRequest._current_request==this._request)AjaxPipeRequest._current_request=null;this._request=null;return this;},setReplayable:function(a){this._replayable=a;return this;},setJSNonBlock:function(a){this._jsNonBlock=a;return this;},getAsyncRequest:function(){return this._request;}});copy_properties(AjaxPipeRequest,{clearCanvas:function(a){var b=ge(a);if(b){b.style.minHeight='600px';DOM.empty(b);}},restoreCanvas:function(a){var b=ge(a);if(b)b.style.minHeight='100px';},getCurrentRequest:function(){return AjaxPipeRequest._current_request;},setCurrentRequest:function(a){AjaxPipeRequest._current_request=a;},isActiveOnPage:function(b){if(!env_get('ajaxpipe_enabled'))return false;var a=new RegExp(env_get('ajaxpipe_inactive_page_regex')||null);return !a.test(URI(b).getPath());}});
var HistoryManager=window.HistoryManager||{_IFRAME_BASE_URI:'http://static.ak.facebook.com/common/history_manager.php',history:null,current:0,fragment:null,_setIframeSrcFragment:function(b){b=b.toString();var a=HistoryManager.history.length-1;HistoryManager.iframe.src=HistoryManager._IFRAME_BASE_URI+'?|index='+a+'#'+encodeURIComponent(b);return HistoryManager;},getIframeSrcFragment:function(){return decodeURIComponent(URI(HistoryManager.iframe.contentWindow.document.location.href).getFragment());},nextframe:function(a,b){if(b){HistoryManager._setIframeSrcFragment(a);return;}if(a!==undefined){HistoryManager.iframeQueue.push(a);}else{HistoryManager.iframeQueue.splice(0,1);HistoryManager.iframeTimeout=null;HistoryManager.checkURI();}if(HistoryManager.iframeQueue.length&&!HistoryManager.iframeTimeout){var c=HistoryManager.iframeQueue[0];HistoryManager.iframeTimeout=setTimeout(function(){HistoryManager._setIframeSrcFragment(c);},100,false);}},isInitialized:function(){return !!HistoryManager._initialized;},init:function(){if(!env_get('ALLOW_TRANSITION_IN_IFRAME')&&window!=window.top)return;if(HistoryManager._initialized)return HistoryManager;var b=URI();var a=b.getFragment()||'';if(a.charAt(0)==='!'){a=a.substr(1);b.setFragment(a);}if(URI.getRequestURI(false).getProtocol().toLowerCase()=='https')HistoryManager._IFRAME_BASE_URI='https://s-static.ak.facebook.com/common/history_manager.php';copy_properties(HistoryManager,{_initialized:true,fragment:a,orig_fragment:a,history:[b],callbacks:[],lastChanged:new Date().getTime(),canonical:URI('#'),fragmentTimeout:null,user:0,iframeTimeout:null,iframeQueue:[],enabled:true,debug:bagofholding});if(window.history&&history.pushState){this.lastURI=document.URL;window.history.replaceState(this.lastURI,null);Event.listen(window,'popstate',function(c){if(c&&c.state&&HistoryManager.lastURI!=c.state){HistoryManager.lastURI=c.state;HistoryManager.lastChanged=(+new Date());HistoryManager.notify(URI(c.state).getUnqualifiedURI().toString());}}.bind(HistoryManager));if(ua.chrome()>5||ua.safari()>533)setInterval(HistoryManager.checkURI,42,false);if(ua.safari()<534)HistoryManager._updateRefererURI(this.lastURI);return HistoryManager;}HistoryManager._updateRefererURI(URI.getRequestURI(false));if(ua.safari()<500||ua.firefox()<2){HistoryManager.enabled=false;return HistoryManager;}if(ua.ie()<8){HistoryManager.iframe=document.createElement('iframe');copy_properties(HistoryManager.iframe.style,{width:'0',height:'0',frameborder:'0',left:'0',top:'0',position:'absolute'});onloadRegister(function(){HistoryManager._setIframeSrcFragment(a);document.body.insertBefore(HistoryManager.iframe,document.body.firstChild);});}else if('onhashchange' in window){Event.listen(window,'hashchange',function(){HistoryManager.checkURI.bind(HistoryManager).defer();});}else setInterval(HistoryManager.checkURI,42,false);return HistoryManager;},registerURIHandler:function(a){HistoryManager.callbacks.push(a);return HistoryManager;},setCanonicalLocation:function(a){HistoryManager.canonical=URI(a);return HistoryManager;},notify:function(c){if(c==HistoryManager.orig_fragment)c=HistoryManager.canonical.getFragment();for(var b=0;b<HistoryManager.callbacks.length;b++)try{if(HistoryManager.callbacks[b](c))return true;}catch(a){}return false;},checkURI:function(){if(new Date().getTime()-HistoryManager.lastChanged<400)return;if(window.history&&history.pushState){var d=URI(document.URL).removeQueryData('ref').toString();var c=URI(HistoryManager.lastURI).removeQueryData('ref').toString();if(d!=c){HistoryManager.lastChanged=(+new Date());HistoryManager.lastURI=d;if(ua.safari()<534)HistoryManager._updateRefererURI(d);HistoryManager.notify(URI(d).getUnqualifiedURI().toString());}return;}if(ua.ie()<8&&HistoryManager.iframeQueue.length)return;if(ua.safari()&&window.history.length==200){if(!HistoryManager.warned)HistoryManager.warned=true;return;}var a=URI().getFragment();if(a.charAt(0)=='!')a=a.substr(1);if(ua.ie()<8)a=HistoryManager.getIframeSrcFragment();a=a.replace(/%23/g,'#');if(a!=HistoryManager.fragment.replace(/%23/g,'#')){HistoryManager.debug([a,' vs ',HistoryManager.fragment,'whl: ',window.history.length,'QHL: ',HistoryManager.history.length].join(' '));for(var b=HistoryManager.history.length-1;b>=0;--b)if(HistoryManager.history[b].getFragment().replace(/%23/g,'#')==a)break;++HistoryManager.user;if(b>=0){HistoryManager.go(b-HistoryManager.current);}else HistoryManager.go('#'+a);--HistoryManager.user;}delete a;},_updateRefererURI:function(e){e=e.toString();if(e.charAt(0)!='/'&&e.indexOf('//')==-1)return;var d=new URI(window.location);if(d.isFacebookURI()){var a=d.getPath()+window.location.search;}else var a='';var c=URI(e).getQualifiedURI().setFragment(a).toString();var b=2048;if(c.length>b)c=c.substring(0,b)+'...';setCookie('x-referer',c);},go:function(c,e,f){if(window.history&&history.pushState){e||typeof(c)=='number';var h=URI(c).removeQueryData('ref').toString();HistoryManager.lastChanged=(+new Date());this.lastURI=h;if(f){window.history.replaceState(c,null,h);}else window.history.pushState(c,null,h);if(ua.safari()<534)HistoryManager._updateRefererURI(c);return false;}HistoryManager.debug('go: '+c);if(e===undefined)e=true;if(!HistoryManager.enabled)if(!e)return false;if(typeof(c)=='number'){if(!c)return false;var b=c+HistoryManager.current;var d=Math.max(0,Math.min(HistoryManager.history.length-1,b));HistoryManager.current=d;b=HistoryManager.history[d].getFragment()||HistoryManager.orig_fragment;b=URI(b).removeQueryData('ref').getUnqualifiedURI().toString();HistoryManager.fragment=b;HistoryManager.lastChanged=new Date().getTime();if(ua.ie()<8){if(HistoryManager.fragmentTimeout)clearTimeout(HistoryManager.fragmentTimeout);HistoryManager._temporary_fragment=b;HistoryManager.fragmentTimeout=setTimeout(function(){window.location.hash='#!'+b;delete HistoryManager._temporary_fragment;},750,false);if(!HistoryManager.user)HistoryManager.nextframe(b,f);}else if(!HistoryManager.user)go_or_replace(window.location,window.location.href.split('#')[0]+'#!'+b,f);if(e)HistoryManager.notify(b);HistoryManager._updateRefererURI(b);return false;}c=URI(c);if(c.getDomain()==URI().getDomain())c=URI('#'+c.getUnqualifiedURI());var a=HistoryManager.history[HistoryManager.current].getFragment();var g=c.getFragment();if(g==a||(a==HistoryManager.orig_fragment&&g==HistoryManager.canonical.getFragment())){if(e)HistoryManager.notify(g);HistoryManager._updateRefererURI(g);return false;}if(f)HistoryManager.current--;var i=(HistoryManager.history.length-HistoryManager.current)-1;HistoryManager.history.splice(HistoryManager.current+1,i);HistoryManager.history.push(URI(c));return HistoryManager.go(1,e,f);},getCurrentFragment:function(){var a=HistoryManager._temporary_fragment!==undefined?HistoryManager._temporary_fragment:URI.getRequestURI(false).getFragment();return a==HistoryManager.orig_fragment?HistoryManager.canonical.getFragment():a;}};var PageTransitions=window.PageTransitions||{_transition_handlers:[],_scroll_positions:{},_scroll_locked:false,isInitialized:function(){return !!PageTransitions._initialized;},_init:function(){if(!env_get('ALLOW_TRANSITION_IN_IFRAME')&&window!=window.top)return;if(PageTransitions._initialized)return PageTransitions;PageTransitions._initialized=true;var d=URI.getRequestURI(false);var a=d.getUnqualifiedURI();var e=URI(a).setFragment(null);var c=a.getFragment();if(c.charAt(0)==='!'&&e.toString()===c.substr(1))a=e;copy_properties(PageTransitions,{_current_uri:a,_most_recent_uri:a,_next_uri:a});var b;if(d.getFragment().startsWith('/')){b=d.getFragment();}else b=a;HistoryManager.init().setCanonicalLocation('#'+b).registerURIHandler(PageTransitions._historyManagerHandler);LinkController.registerFallbackHandler(PageTransitions._rewriteHref,LinkController.TARGETS|LinkController.MODIFIERS);LinkController.registerFallbackHandler(PageTransitions._onlinkclick);FormController.registerFallbackHandler(PageTransitions._onformsubmit);Event.listen(window,'scroll',function(){if(!PageTransitions._scroll_locked)PageTransitions._scroll_positions[PageTransitions._current_uri]=Vector2.getScrollPosition();});return PageTransitions;},registerHandler:function(b,a){PageTransitions._init();a=a||5;if(!PageTransitions._transition_handlers[a])PageTransitions._transition_handlers[a]=[];PageTransitions._transition_handlers[a].push(b);},getCurrentURI:function(a){if(!PageTransitions._current_uri&&!a)return new URI(PageTransitions._most_recent_uri);return new URI(PageTransitions._current_uri);},getMostRecentURI:function(){return new URI(PageTransitions._most_recent_uri);},getNextURI:function(){return new URI(PageTransitions._next_uri);},_rewriteHref:function(a){var c=a.getAttribute('href');var b=_computeRelativeURI(PageTransitions._most_recent_uri.getQualifiedURI(),c).toString();if(c!=b)a.setAttribute('href',b);},_onlinkclick:function(a){_BusyUIManager.lookBusy(a);PageTransitions.go(a.getAttribute('href'));return false;},_onformsubmit:function(a){var c=new URI(Form.getAttribute(a,'action')||''),b=_computeRelativeURI(PageTransitions._most_recent_uri,c);a.setAttribute('action',b.toString());if((Form.getAttribute(a,'method')||'GET').toUpperCase()==='GET'){PageTransitions.go(b.addQueryData(Form.serialize(a)));return false;}},go:function(d,b){var a=new URI(d).removeQueryData('quickling').getQualifiedURI();var c=a.getUnqualifiedURI();delete PageTransitions._scroll_positions[c];!b&&user_action({href:a.toString()},'uri',null,'INDIRECT');_BusyUIManager.lookBusy();PageTransitions._loadPage(a,function(e){if(e){HistoryManager.go(a.toString(),false,b);}else go_or_replace(window.location,a,b);});},_historyManagerHandler:function(a){if(a.charAt(0)!='/')return false;user_action({href:a},'h',null);PageTransitions._loadPage(new URI(a),function(b){if(!b)go_or_replace(window.location,a,true);});return true;},_loadPage:function(e,c){if(URI(e).getFragment()&&are_equal(URI(e).setFragment(null).getQualifiedURI(),URI(PageTransitions._current_uri).setFragment(null).getQualifiedURI())){PageTransitions._current_uri=PageTransitions._most_recent_uri=e;PageTransitions.restoreScrollPosition();_BusyUIManager.stopLookingBusy();return;}var d=PageTransitions._scroll_positions[PageTransitions._current_uri];PageTransitions._current_uri=null;PageTransitions._next_uri=e;if(d)DOMScroll.scrollTo(d,false);var b=function(){PageTransitions._scroll_locked=true;var f=PageTransitions._handleTransition(e);c&&c(f);};var a=_runHooks('onbeforeleavehooks');if(a){_BusyUIManager.stopLookingBusy();PageTransitions._warnBeforeLeaving(a,b);}else b();},_handleTransition:function(f){window.onbeforeleavehooks=undefined;_BusyUIManager.lookBusy();if(!f.isSameOrigin())return false;var e=window.AsyncRequest&&AsyncRequest.getLastId();Arbiter.inform("pre_page_transition",{from:PageTransitions.getMostRecentURI(),to:f});for(var b=PageTransitions._transition_handlers.length-1;b>=0;--b){var a=PageTransitions._transition_handlers[b];if(!a)continue;for(var c=a.length-1;c>=0;--c)if(a[c](f)===true){var d={sender:this,uri:f,id:e};Arbiter.inform("page_transition",d);return true;}else a.splice(c,1);}return false;},unifyURI:function(){PageTransitions._current_uri=PageTransitions._most_recent_uri=PageTransitions._next_uri;},transitionComplete:function(a){PageTransitions._executeCompletionCallback();_BusyUIManager.stopLookingBusy();PageTransitions.unifyURI();if(!a)PageTransitions.restoreScrollPosition();try{if(document.activeElement&&document.activeElement.nodeName==='A')document.activeElement.blur();}catch(b){}},_executeCompletionCallback:function(){if(PageTransitions._completionCallback)PageTransitions._completionCallback();PageTransitions._completionCallback=null;},setCompletionCallback:function(a){PageTransitions._completionCallback=a;},_warnBeforeLeaving:function(b,a){new Dialog().setTitle(_tx("Are you sure you want to leave this page?")).setBody(htmlize(b)).setButtons([{name:'leave_page',label:_tx("Leave this Page"),handler:a},{name:'continue_editing',label:_tx("Stay on this Page"),className:'inputaux'}]).setModal().show();},restoreScrollPosition:function(){PageTransitions._scroll_locked=false;var c=PageTransitions._current_uri;var e=PageTransitions._scroll_positions[c];if(e){DOMScroll.scrollTo(e,false);return;}function d(f){return (f||null)&&(DOM.scry(document.body,"a[name='"+escape_js_quotes(f)+"']")[0]||ge(f));}var a=d(URI(c).getFragment());if(a){var b=Vector2.getElementPosition(a);b.x=0;DOMScroll.scrollTo(b);}}};function _computeRelativeURI(d,b){var e=new URI(),c=b;d=new URI(d);b=new URI(b);if(b.getDomain()&&!b.isFacebookURI())return c;var f=d;var a=['Protocol','Domain','Port','Path','QueryData','Fragment'];a.forEach(function(h){var g=h=='Path'&&f===d;if(g)e.setPath(_computeRelativePath(d.getPath(),b.getPath()));if(!is_empty(b['get'+h]()))f=b;if(!g)e['set'+h](f['get'+h]());});return e;}function _computeRelativePath(b,a){if(!a)return b;if(a.charAt(0)=='/')return a;var c=b.split('/').slice(0,-1);c[0]!=='';a.split('/').forEach(function(d){if(!(d=='.'))if(d=='..'){if(c.length>1)c=c.slice(0,-1);}else c.push(d);});return c.join('/');}function go_or_replace(a,d,c){var e=new URI(d);if(a.pathname=='/'&&e.getPath()!='/'&&e.isQuicklingEnabled()){var b=a.search?{}:{q:''};e=new URI().setPath('/').setQueryData(b).setFragment(e.getUnqualifiedURI()).toString();d=e.toString();}if(c&&!(ua.ie()<8)){a.replace(d);}else if(a.href==d){a.reload();}else a.href=d;}var _BusyUIManager=window._BusyUIManager||{_looking_busy:false,_original_cursors:[],lookBusy:function(a){if(a)_BusyUIManager._giveProgressCursor(a);if(_BusyUIManager._looking_busy)return;_BusyUIManager._looking_busy=true;_BusyUIManager._giveProgressCursor(document.body);},stopLookingBusy:function(){if(!_BusyUIManager._looking_busy)return;_BusyUIManager._looking_busy=false;while(_BusyUIManager._original_cursors.length){var c=_BusyUIManager._original_cursors.pop();var b=c[0];var a=c[1];if(b.style)b.style.cursor=a||'';}},_giveProgressCursor:function(a){if(!ua.safari()){_BusyUIManager._original_cursors.push([a,a.style.cursor]);a.style.cursor='progress';}}};
UserActivity=window.UserActivity||{SIGNAL:'useractivity/activity',_lastActive:+new Date(),_listeners:null,DEFAULT_IDLE_MS:5000,EVENT_INTERVAL_MS:500,onActivity:function(event){UserActivity._listeners.forEach(function(a){a.remove();});UserActivity._listeners=null;UserActivity._lastActive=+new Date();setTimeout(UserActivity.listen,UserActivity.EVENT_INTERVAL_MS);Arbiter.inform(UserActivity.SIGNAL,event);},listen:function(){if(UserActivity._listeners)return;UserActivity._listeners=[Event.listen(document.body,'mouseover',UserActivity.onActivity),Event.listen(document.body,'keydown',UserActivity.onActivity),Event.listen(document.body,'click',UserActivity.onActivity)];},subscribe:function(a){UserActivity.listen();return Arbiter.subscribe(UserActivity.SIGNAL,a,Arbiter.SUBSCRIBE_NEW);},unsubscribe:function(a){Arbiter.unsubscribe(a);},isActive:function(a){return (new Date()-UserActivity._lastActive<(a||UserActivity.DEFAULT_IDLE_MS));}};onloadRegister(UserActivity.listen);
function useFacebookReferer(b,a){var d=false;function e(){if(d)return;d=true;b.contentWindow.document.body.style.margin=0;a();}var c=(URI().isSecure()?'https://s-static.ak.facebook.com':'http://static.ak.facebook.com')+'/common/referer_frame.php';Event.listen(b,'load',e);b.src=c;}function useFacebookRefererHtml(b,a){useFacebookReferer(b,function(){b.contentWindow.document.body.innerHTML=a;});}
if(typeof deconcept=="undefined")var deconcept={};if(typeof deconcept.util=="undefined")deconcept.util={};if(typeof deconcept.SWFObjectUtil=="undefined")deconcept.SWFObjectUtil={};deconcept.SWFObject=function(h,d,j,c,i,a,f,l,g,b){if(!document.getElementById)return;this.DETECT_KEY=b?b:'detectflash';this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];this.fallback_html='';this.fallback_js_fcn=function(){};if(h)this.setAttribute('swf',h);if(d)this.setAttribute('id',d);if(j)this.setAttribute('width',j);if(c)this.setAttribute('height',c);this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(i){if(!(i instanceof Array))i=[i];var k;i.each(function(n){k=new deconcept.PlayerVersion(n.toString().split('.'));if(k.major==this.installedVer.major){this.setAttribute('version',k);return;}else if(!this.getAttribute('version')||k.major<this.getAttribute('version').major)this.setAttribute('version',k);}.bind(this));}if(!window.opera&&document.all&&this.installedVer.major>7)if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true;}if(a)this.addParam('bgcolor',a);var e=f?f:'high';this.addParam('quality',e);this.setAttribute('useExpressInstall',false);this.setAttribute('doExpressInstall',false);var m=(l)?l:window.location;this.setAttribute('xiRedirectUrl',m);this.setAttribute('redirectUrl','');if(g)this.setAttribute('redirectUrl',g);this.setAttribute('useIframe',false);};deconcept.SWFObject.prototype={useExpressInstall:function(a){this.xiSWFPath=!a?"/swf/expressinstall.swf":a;this.setAttribute('useExpressInstall',true);},setAttribute:function(a,b){this.attributes[a]=b;},getAttribute:function(a){return this.attributes[a]||"";},addParam:function(a,b){this.params[a]=b;},getParams:function(){return this.params;},addVariable:function(a,b){this.variables[a]=b;},getVariable:function(a){return this.variables[a]||"";},getVariables:function(){return this.variables;},getVariablePairs:function(){var b=[];var a;var c=this.getVariables();for(a in c)b[b.length]=a+"="+c[a];return b;},getSWFHTML:function(){var d="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute('swf',this.xiSWFPath);}d='<embed type="application/x-shockwave-flash" src="'+htmlspecialchars(this.getAttribute('swf'))+'" width="'+htmlspecialchars(this.getAttribute('width'))+'" height="'+htmlspecialchars(this.getAttribute('height'))+'" style="'+htmlspecialchars(this.getAttribute('style')||"")+'"';d+=' id="'+htmlspecialchars(this.getAttribute('id'))+'" name="'+htmlspecialchars(this.getAttribute('id'))+'" ';var c=this.getParams();for(var a in c)d+=htmlspecialchars(a)+'="'+htmlspecialchars(c[a])+'" ';var b=this.getVariablePairs().join("&");if(b.length>0)d+='flashvars="'+b+'"';d+='/>';}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute('swf',this.xiSWFPath);}d='<object id="'+this.getAttribute('id')+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute('width')+'" height="'+this.getAttribute('height')+'" style="'+(this.getAttribute('style')||"")+'">';d+='<param name="movie" value="'+this.getAttribute('swf')+'" />';var c=this.getParams();for(var a in c)d+='<param name="'+a+'" value="'+c[a]+'" />';var b=this.getVariablePairs().join("&");if(b.length>0)d+='<param name="flashvars" value="'+b+'" />';d+="</object>";}return d;},write:function(a){if(this.getAttribute('useExpressInstall')){var b=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(b)&&!this.installedVer.versionIsValid(this.getAttribute('version'))){this.setAttribute('doExpressInstall',true);this.addVariable("MMredirectURL",escape(this.getAttribute('xiRedirectUrl')));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}var c=(typeof a=='string')?document.getElementById(a):a;if(!c)return false;if(this.skipDetect||this.getAttribute('doExpressInstall')||this.installedVer.versionIsValid(this.getAttribute('version'))){if(!this.getAttribute('useIframe')){c.innerHTML=this.getSWFHTML();}else this._createIframe(c);return true;}else{if(this.getAttribute('redirectUrl')!="")document.location.replace(this.getAttribute('redirectUrl'));need_version=this.getAttribute('version').major+'.'+this.getAttribute('version').minor+'.'+this.getAttribute('version').rev;have_version=this.installedVer.major+'.'+this.installedVer.minor+'.'+this.installedVer.rev;this.fallback_js_fcn(have_version,need_version);c.innerHTML=this.fallback_html;}return false;},_createIframe:function(b){var a=$N('iframe',{width:this.getAttribute('width'),height:this.getAttribute('height'),frameBorder:0});DOM.empty(b);b.appendChild(a);useFacebookRefererHtml.bind(null,a,this.getSWFHTML()).defer();}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var a=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){for(var f=0;f<navigator.plugins.length;f++)try{var x=navigator.plugins[f];if(x.name=='Shockwave Flash'){PlayerVersion_tmp=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+(r|d)|\s+b[0-9]+)/,".").split("."));if(typeof a=='undefined'||PlayerVersion_tmp.major>a.major||(PlayerVersion_tmp.major==a.major&&(PlayerVersion_tmp.minor>a.minor||(PlayerVersion_tmp.minor==a.minor&&PlayerVersion_tmp.rev>a.rev))))a=PlayerVersion_tmp;}}catch(e){}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var b=1;var c=3;while(b)try{c++;b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+c);a=new deconcept.PlayerVersion([c,0,0]);}catch(d){b=null;}}else{try{var b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(d){try{var b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");a=new deconcept.PlayerVersion([6,0,21]);b.AllowScriptAccess="always";}catch(d){if(a.major==6)return a;}try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(d){}}if(b!=null)a=new deconcept.PlayerVersion(b.GetVariable("$version").split(" ")[1].split(","));}return a;};deconcept.PlayerVersion=function(a){this.major=a[0]!=null?parseInt(a[0]):0;this.minor=a[1]!=null?parseInt(a[1]):0;this.rev=a[2]!=null?parseInt(a[2]):0;};deconcept.PlayerVersion.prototype.versionIsValid=function(a){if(this.major<a.major)return false;if(this.major>a.major)return true;if(this.minor<a.minor)return false;if(this.minor>a.minor)return true;if(this.rev<a.rev)return false;return true;};deconcept.util={getRequestParameter:function(c){var d=document.location.search||document.location.hash;if(c==null)return d;if(d){var b=d.substring(1).split("&");for(var a=0;a<b.length;a++)if(b[a].substring(0,b[a].indexOf("="))==c)return b[a].substring((b[a].indexOf("=")+1));}return "";}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var b=document.getElementsByTagName("OBJECT");for(var a=b.length-1;a>=0;a--){b[a].style.display='none';for(var c in b[a])if(typeof b[a][c]=='function')b[a][c]=function(){};}};if(!document.getElementById&&document.all)document.getElementById=function(a){return document.all[a];};var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;var flash_update_dialog_shown=false;function spawn_flash_update_dialog(a,b){if(flash_update_dialog_shown)return;flash_update_dialog_shown=true;new AsyncRequest().setURI('/ajax/flash_update_dialog.php').setData({have_version:a,need_version:b}).setMethod('GET').setReadOnly(true).send();}function setFlashFallback(d,g){var b=ge(d);var a=deconcept.SWFObjectUtil.getPlayerVersion();var e;g.each(function(h){h=new deconcept.PlayerVersion(h.toString().split('.'));if(h.major==a.major){e=h;return;}else if(typeof e=='undefined'||h.major<e.major)e=h;}.bind(this));if(b&&a.major>0){var c=a.major+'.'+a.minor+'.'+a.rev;var f=e.major+'.'+e.minor+'.'+e.rev;b.innerHTML=_tx("Flash {required-version} is required to view this content. Your current version is {current-version}. Please download the latest Flash Player.",{'required-version':f,'current-version':c});}}function getFlashPlayer(){goURI('http://get.adobe.com/flashplayer');return false;}function showFlashErrorDialog(b,a){Bootloader.loadComponents('error-dialog',function(){ErrorDialog.show(b,a);});}
var TooltipLink={setTooltipText:function(a,b){a=Parent.byClass(a,'uiTooltip');if(a)DOM.setContent(DOM.find(a,'span.uiTooltipText'),b);},setTooltipEnabled:function(b,a){b=Parent.byClass(b,'uiTooltip');b&&CSS.conditionClass(b,'uiTooltipDisabled',!a);}};
var UFICommentLike={showDetails:function(a,b,c){c.onmouseover=bagofholding;new AsyncRequest().setURI('/ajax/like/tooltip.php').setData({comment_fbid:a,comment_from:b}).setHandler(function(d){TooltipLink.setTooltipText(c,d.getPayload().like_sentence);}).setErrorHandler(bagofholding).send();}};
var UFIOptimistic={COMMENT_SEND_EVENT:'ufi/comment',_commentSeqNo:0,init:function(a){this._commentTemplate=a;if(!this._loaded){Event.listen(document.documentElement,'click',this._clickHandler.bind(this),Event.Priority.URGENT);this._loaded=true;}},_clickHandler:function(event){var i=event.getTarget();var l=i.name=='comment'&&i.parentNode&&Parent.byClass(i,'optimistic_submit');if(!l)return true;var e=i.form;var k=DOM.find(e,'textarea');if(Input.isEmpty(k))return true;fc_uncollapse(e);var a=this._commentTemplate.render();var j=XHPTemplate.getNode(a,'text');DOM.setContent(j,HTML(htmlize(trim(k.value))));var c=DOM.scry(e,'ul.commentList')[0];if(!c)return true;CSS.show(c.parentNode);c.appendChild(a);var b=c.lastChild;var g=rand32();b.id='optimistic_comment_'+g+'_'+this._commentSeqNo++;var d=Form.serialize(e);d.comment_replace=b.id;d.comment=1;function h(){new AsyncRequest(Form.getAttribute(e,'action')).setData(d).setRelativeTo(e).setErrorHandler(function(m){CSS.addClass(b,'uiUfiCommentFailed');Event.listen(XHPTemplate.getNode(a,'retry_link'),'click',h);AsyncResponse.defaultErrorHandler(m);}).send();}h();k.value=k.style.height='';k.focus();var f=window.MentionsInput&&MentionsInput.getInstance(k);f&&f.reset();Arbiter.inform(UFIOptimistic.COMMENT_SEND_EVENT,{form:e});return false;}};
window.__UIControllerRegistry=window.__UIControllerRegistry||{};
function UIPagelet(c,d,a,b){this._id=c||null;this._element=ge(c||$N('div'));this._src=d||null;this._context_data=a||{};this._data=b||{};this._handler=bagofholding;this._request=null;this._use_ajaxpipe=false;this._is_bundle=true;this._allow_cross_page_transition=false;this._append=false;return this;}UIPagelet.loadFromEndpoint=function(b,e,a,c){c=c||{};var d=('/pagelet/generic.php/'+b).replace(/\/+/g,'/');if(c.subdomain)d=URI(d).setSubdomain(c.subdomain);new UIPagelet(e,d,a).setUseAjaxPipe(c.usePipe).setBundleOption(b.substring(0,8)!='/intern/'&&c.bundle!==false).setReplayable(c.replayable).setAppend(c.append).setJSNonBlock(c.jsNonblock).setAllowCrossPageTransition(c.crossPage).go();};copy_properties(UIPagelet.prototype,{getElement:function(a){a=a||false;if(a)this._element=ge(this._id);return this._element;},setHandler:function(a){this._handler=a;return this;},go:function(b,a){if(arguments.length>=2||typeof b=='string'){this._src=b;this._data=a||{};}else if(arguments.length==1)this._data=b;this.refresh();return this;},setAllowCrossPageTransition:function(a){this._allow_cross_page_transition=a;return this;},setBundleOption:function(a){this._is_bundle=a;return this;},refresh:function(b){var a=function(d){this._request=null;if(b&&this._id)this._element=ge(this._id);var c=HTML(d.getPayload());if(this._append){DOM.appendContent(this._element,c);}else DOM.setContent(this._element,c);this._handler();}.bind(this);if(this._use_ajaxpipe){this._request=new AjaxPipeRequest();this._request.setCanvasId(this._id).setAppend(this._append).setJSNonBlock(this._jsNonblock);}else this._request=new AsyncRequest().setMethod('GET').setReadOnly(true).setOption('bundle',this._is_bundle).setHandler(a);this._request.setURI(this._src).setReplayable(this._replayable).setAllowCrossPageTransition(this._allow_cross_page_transition).setData({data:JSON.stringify(merge(this._context_data,this._data))}).send();return this;},cancel:function(){if(this._request)this._request.abort();},setUseAjaxPipe:function(a){this._use_ajaxpipe=!!a;return this;},setReplayable:function(a){this._replayable=!!a;return this;},setAppend:function(a){this._append=!!a;return this;},setJSNonBlock:function(a){this._jsNonblock=!!a;return this;}});
function Toggler(){this.init();}(function(){var d=[];var b;function c(){c=bagofholding;Event.listen(document.documentElement,'click',function(event){var e=event.getTarget();d.each(function(f){f.active&&!f.sticky&&!DOM.contains(f.getActive(),e)&&f.hide();});},Event.Priority.URGENT);}function a(f,e){if(f instanceof Toggler)return f;return Toggler.getInstance(e);}Toggler.mixin('Arbiter',{init:function(){this.active=null;this.togglers={};this.setSticky(false);d.push(this);this.subscribe(['show','hide'],Toggler.inform.bind(Toggler));c();},show:function(f){var e=a(this,f);var g=e.active;if(f!==g){g&&e.hide();e.active=f;CSS.addClass(f,'openToggler');DOM.appendContent(f,e.getToggler('next'));DOM.prependContent(f,e.getToggler('prev'));e.inform('show',e);}},hide:function(g){var f=a(this,g);var e=f.active;if(e&&(!g||g===e)){CSS.removeClass(e,'openToggler');values(f.togglers).each(DOM.remove);f.inform('hide',f);f.active=null;}},toggle:function(f){var e=a(this,f);if(e.active===f){e.hide();}else e.show(f);},getActive:function(){return a(this).active;},getToggler:function(f){var e=a(this);if(!e.togglers[f])e.togglers[f]=$N('button',{className:'hideToggler',onfocus:function(){var g=DOM.scry(e.active,'[rel="toggle"]')[0];g&&g.focus();e.hide();}});return this.togglers[f];},setSticky:function(f){var e=a(this);f=f!==false;if(f!==e.sticky){e.sticky=f;if(f){e._pt&&Arbiter.unsubscribe(e._pt);}else e._pt=Arbiter.subscribe('page_transition',e.hide.bind(e,null));}return e;}});copy_properties(Toggler,Toggler.prototype);copy_properties(Toggler,{bootstrap:function(e){var f=e.parentNode;Toggler.getInstance(f).toggle(f);},createInstance:function(f){var e=new Toggler().setSticky(true);DataStore.set(f,'toggler',e);return e;},getInstance:function(f){while(f){var e=DataStore.get(f,'toggler');if(e)return e;f=f.parentNode;}return (b=b||new Toggler());},listen:function(g,f,e){return Toggler.subscribe($A(g),function(i,h){if(h.getActive()===f)return e(i,h);});},subscribe:(function(e){return function(g,f){g=$A(g);if(g.contains('show'))d.each(function(h){if(h.getActive())f.curry('show',h).defer();});return e(g,f);};})(Toggler.subscribe.bind(Toggler))});})();
var TypeaheadUtil=(function(){var b=/[ ]+/g;var c=/[^ ]+/g;var a=/[.,+*?$|#{}()\^\-\[\]\\\/!@%'"~=<>_:;\u2010\u2011\u2012\u2013\u2014\u2015\u30fb]/g;var d={"\u0430":'a',"\u00e0":'a',"\u00e1":'a',"\u00e2":'a',"\u00e3":'a',"\u00e4":'a',"\u00e5":'a',"\u0431":'b',"\u0446":'c',"\u00e7":'c',"\u010d":'c',"\u0434":'d',"\u00f0":'d',"\u010f":'d',"\u044d":'e',"\u0435":'e',"\u00e8":'e',"\u00e9":'e',"\u00ea":'e',"\u00eb":'e',"\u011b":'e',"\u0444":'f',"\u0433":'g',"\u011f":'g',"\u0445":'h',"\u0438":'i',"\u00ec":'i',"\u00ed":'i',"\u00ee":'i',"\u00ef":'i',"\u0131":'i',"\u0439":'j',"\u043a":'k',"\u043b":'l',"\u013e":'l',"\u013a":'l',"\u043c":'m',"\u043d":'n',"\u00f1":'n',"\u0148":'n',"\u043e":'o',"\u00f8":'o',"\u00f6":'o',"\u00f5":'o',"\u00f4":'o',"\u00f3":'o',"\u00f2":'o',"\u043f":'p',"\u0440":'r',"\u0159":'r',"\u0155":'r',"\u0441":'s',"\u015f":'s',"\u0161":'s',"\u0442":'t',"\u0165":'t',"\u0443":'u',"\u044e":'u',"\u00fc":'u',"\u00fb":'u',"\u00fa":'u',"\u00f9":'u',"\u016f":'u',"\u0432":'v',"\u044b":'y',"\u00ff":'y',"\u00fd":'y',"\u0437":'z',"\u017e":'z',"\u00e6":'ae',"\u0153":'oe',"\u0446":'ts',"\u0447":'ch',"\u0448":'sh',"\u044f":'ya'};function e(l){return l?l.replace(a,' '):'';}function f(o){o=(''+o).toLowerCase();var n='';var l='';for(var m=o.length;m--;){l=o.charAt(m);n=(d[l]||l)+n;}return n.replace(b,' ');}function j(l,m){return m.length-l.length;}function k(o,l,n){o=e(f(o));var p=l||[];var m=c.exec(o);while(m){m=m[0];p.push(m);m=c.exec(o);}n&&p.sort(j);return p;}function h(n,o,m){var l={};return o.every(function(q){for(var p=0;p<m.length;++p){var r=m[p];if(!l[p]&&(r==q||(n&&r.indexOf(q)===0)))return (l[p]=true);}return false;});}var g=h.curry(false);var i=h.curry(true);return {flatten:f,tokenize:k,isPrefixMatch:i,isExactMatch:g};})();
function MentionsInput(a){DataStore.set(a,'MentionsInput',this);this._root=a;}MentionsInput.getInstance=function(a){var b=Parent.byClass(a,'uiMentionsInput');return b?DataStore.get(b,'MentionsInput'):null;};(function(){var a='@\\uff20';var e='.,+*?$|#{}()\\^\\-\\[\\]\\\\\/!@%&\'"~=<>_:;';var d='[A-Z][^ '+e+']';var c='(?:['+a+']([^'+a+e+']{0,20}))';var b='(?:(?:\\b'+d+'+(?: '+d+'*)?)|'+c+')';var f='(?:\\b'+d+'{3,}(?: '+d+'*)?)';MentionsInput.prototype={_matcher:new RegExp(c+'$'),_autoMatcher:new RegExp(b+'$'),_userMatcher:new RegExp(f+'$')};})();MentionsInput.mixin('Arbiter',{init:function(a,b){this.init=bagofholding;this._typeahead=Typeahead.getInstance(DOM.find(this._root,'.mentionsTypeahead'));this._highlighter=DOM.find(this._root,'.highlighter').firstChild;this._hiddenInput=DOM.find(this._root,'.mentionsHidden');this._input=this._typeahead.getCore().getElement();this._maxMentions=a.max||6;this._autoSuggest=a.auto||false;this._canReduceTokens=a.reduce||false;if(ua.firefox()<4){this._input.blur();setTimeout(function(){this._input.focus();}.bind(this));}var c=this._input.name;this._input.name=c+'_text';this._hiddenInput.name=c;this._initEvents();this._initTypeahead();this.reset(b);this.inform('init');},reset:function(b){this._mentioned={};this._numMentioned=0;this._hiddenInput&&(this._hiddenInput.value='');this._highlighter&&DOM.empty(this._highlighter);if(b){Input.setValue(this._input,b.flattened);for(var a in b.mention_data)this._addToken({uid:a,text:b.mention_data[a],type:'unknown'});}this._updateTypeahead();this._update();},_initEvents:function(){var c=this._update.bind(this);var a=c.defer.bind(c,20);var b={change:c,keydown:a,focus:this._updateWidth.bind(this)};if(ua.firefox())b.text=c;if(ua.firefox()<4){b.keypress=b.keydown;delete b.keydown;}Event.listen(this._input,b);},_initTypeahead:function(){this._typeahead.subscribe('select',function(b,c){var d=c.selected;this._addToken({uid:d.uid,text:d.text,type:d.type});this._updateValue();this._typeahead.getView().hide();this._inserting=true;}.bind(this));var a=null;this._typeahead.subscribe('render',function(event){if(a===null){a=Input.getSubmitOnEnter(this._input);Input.setSubmitOnEnter(this._input,false);}}.bind(this));this._typeahead.subscribe('reset',function(event){if(a!==null){Input.setSubmitOnEnter(this._input,a);a=null;}}.bind(this));this._typeahead.getCore().suffix='';this._typeahead.getData().setFilter(this._filterResults.bind(this));},_filterResults:function(a){var b=this._typeahead.getCore().getRawValue();var c=this._typeahead.getCore().getValue();if(this._matcher.test(b)){return true;}else if(this._userMatcher.test(c)){return a.type=='user';}else return a.type=='user'&&TypeaheadUtil.isExactMatch(TypeaheadUtil.tokenize(c),a.preparedTokens);},getTypeahead:function(){return this._typeahead;},_addToken:function(a){this._mentioned[a.uid]=a;this._numMentioned++;this._updateTypeahead();},_removeToken:function(a){delete this._mentioned[a];this._numMentioned--;this._updateTypeahead();},_update:function(){this._updateTokens();this._updateValue();if(this._inserting){this._inserting=false;this._typeahead.getView().reset().show();}},_reduceToken:function(f,d){var e=d.split(' ');var b=[];for(var a=0;a<e.length;a++)if(f.indexOf(e[a])!=-1)b.push(e[a]);e=b;for(a=1;a<e.length;a++)for(var c=1;c<e[a-1].length+1;c++)if(f.indexOf(e[a-1].substr(0,c)+e[a])!=-1)e.splice(a-1,1);while(f.indexOf(e.join(' '))==-1)e.splice(0,1);return e.join(' ');},_updateTokens:function(){var d=Input.getValue(this._input);for(var c in this._mentioned){var b=this._mentioned[c].text;var a;if(this._mentioned[c].type=='user'&&this._canReduceTokens&&(a=this._reduceToken(d,b))!==''){this._mentioned[c].text=a;}else if(!b||d.indexOf(b)==-1||typeof b!=='string')this._removeToken(c);}},_updateValue:function(){var d,c;var e=Input.getValue(this._input);var b=this._mentioned;for(d in b){c=b[d].text;e=e.replace(c,'@['+d+':]');}var a=htmlize(e);for(d in b){c=b[d].text;a=a.replace('@['+d+':]','<b>'+htmlize(c)+'</b>');e=e.replace('@['+d+':]','@['+d+':'+c+']');}if(ua.ie())a=a.replace(/ {2}/g,'&nbsp; ');this._hiddenInput.value=e;DOM.setContent(this._highlighter,HTML(a));},_updateWidth:function(){var a=TextAreaControl.getWidth(this._input);if(ua.ie()<=7){a-=parseInt(CSS.getStyle(this._highlighter,'paddingLeft'),10);Parent.byClass(this._highlighter,'highlighter').style.zoom=1;}this._highlighter.style.width=a+'px';},_updateTypeahead:function(){var a=this._typeahead.getCore();var b=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)b=this._autoSuggest?this._autoMatcher:this._matcher;a.matcher=b;a.setExclusions(keys(this._mentioned));}});
var Menu=function(){var i='menu:mouseover';var a=null;function b(k){return Parent.byClass(k,'uiMenu');}function c(k){return Parent.byClass(k,'uiMenuItem');}function d(k){if(document.activeElement){var l=c(document.activeElement);return k.indexOf(l);}return -1;}function e(k){return DOM.find(k,'a.itemAnchor');}function f(k){return CSS.hasClass(k,'checked');}function g(k){return !CSS.hasClass(k,'disabled');}function h(event){var k=c(event.getTarget());k&&Menu.focusItem(k);}function j(k){Menu.inform(Menu.ITEM_SELECTED,{menu:b(k),item:k});}onloadRegister(function(){var k={};k.click=function(event){var n=c(event.getTarget());if(n&&g(n)){j(n);var l=e(n);var m=l.href;var o=l.getAttribute('rel');return (o&&o!=='ignore')||(m&&m.charAt(m.length-1)!=='#');}};k.keydown=function(event){var u=event.getTarget();if(!a||DOM.isNode(u,['input','textarea']))return;var q=Event.getKeyCode(event);switch(q){case KEYS.UP:case KEYS.DOWN:var m=Menu.getEnabledItems(a);var o=d(m);Menu.focusItem(m[o+(q===KEYS.UP?-1:1)]);return false;case KEYS.SPACE:var t=c(u);if(t){j(t);event.prevent();}break;default:var l=String.fromCharCode(q).toLowerCase();var p=Menu.getEnabledItems(a);var o=d(p);var n=o;var r=p.length;while((~o&&(n=++n%r)!==o)||(!~o&&++n<r)){var s=Menu.getItemLabel(p[n]);if(s&&s.charAt(0).toLowerCase()===l){Menu.focusItem(p[n]);return false;}}}};Event.listen(document.body,k);});return copy_properties(new Arbiter(),{ITEM_SELECTED:'menu/item-selected',ITEM_TOGGLED:'menu/item-toggled',focusItem:function(k){if(k){this._removeSelected(b(k));CSS.addClass(k,'selected');g(k)&&e(k).focus();}},getEnabledItems:function(k){return Menu.getItems(k).filter(g);},getCheckedItems:function(k){return Menu.getItems(k).filter(f);},getItems:function(k){return DOM.scry(k,'li.uiMenuItem');},getItemLabel:function(k){return k.getAttribute('data-label',2)||'';},isItemChecked:function(k){return CSS.hasClass(k,'checked');},register:function(k){k=b(k);if(!DataStore.get(k,i))DataStore.set(k,i,Event.listen(k,'mouseover',h));a=k;},setItemEnabled:function(l,k){if(!k&&!DOM.scry(l,'span.disabledAnchor')[0])DOM.appendContent(l,$N('span',{className:'itemAnchor disabledAnchor'},HTML(e(l).innerHTML)));CSS.conditionClass(l,'disabled',!k);},toggleItem:function(l){var k=!Menu.isItemChecked(l);CSS.conditionClass(l,'checked',k);e(l).setAttribute('aria-checked',k);Menu.inform(Menu.ITEM_TOGGLED,{menu:b(l),item:l,checked:k});},unregister:function(l){l=b(l);var k=DataStore.remove(l,i);k&&k.remove();a=null;this._removeSelected(l);},_removeSelected:function(k){Menu.getItems(k).filter(function(l){return CSS.hasClass(l,'selected');}).each(function(l){CSS.removeClass(l,'selected');});}});}();
var Selector=function(){var a;var k=false;function b(m){return Parent.byClass(m,'uiSelector');}function c(m){return Parent.byClass(m,'uiSelectorButton');}function d(m){return DOM.find(m,'a.uiSelectorButton');}function g(m){return DOM.scry(m,'select')[0];}function e(m){return DOM.scry(m,'ul.uiSelectorMenu')[0];}function f(m){return DOM.find(m,'div.uiSelectorMenuWrapper');}function h(){h=bagofholding;Menu.subscribe(Menu.ITEM_SELECTED,function(m,o){if(!a||!o||o.menu!==e(a))return;var p=i(a);var r=j(o.item);if(r){var n=a;var s=Selector.inform('select',{selector:n,option:o.item});if(s===false)return;var q=Selector.isOptionSelected(o.item);if(p||!q){Selector.setSelected(n,Selector.getOptionValue(o.item),!q);Selector.inform('toggle',{selector:n,option:o.item});Selector.inform('change',{selector:n});if(l(n))DataStore.set(n,'dirty',true);}}if(!p||!r)a&&Selector.toggle(a);});}function i(m){return !!m.getAttribute('data-multiple');}function j(m){return CSS.hasClass(m,'uiSelectorOption');}function l(m){return !!m.getAttribute('data-autosubmit');}onloadRegister(function(){var m={};m.keydown=function(event){var o=event.getTarget();if(DOM.isNode(o,['input','textarea']))return;switch(Event.getKeyCode(event)){case KEYS.DOWN:case KEYS.SPACE:case KEYS.UP:k=true;if(c(o)){var n=b(o);Selector.toggle(n);return false;}break;case KEYS.ESC:k=true;if(a){Selector.toggle(a);return false;}break;case KEYS.RETURN:k=true;break;}};m.keyup=function(){!function(){k=false;}.defer();};Event.listen(document.body,m);Toggler.subscribe(['show','hide'],function(v,u){var r=b(u.getActive());if(r){h();var o=d(r);var p=e(r);var s=v==='show';if(s){a=r;if(CSS.hasClass(o,'uiButtonDisabled')){Selector.setEnabled(r,false);return false;}if(!p){var n=o.getAttribute('ajaxify');if(n){var w=HTML('<div class="uiSelectorMenuWrapper">'+'<ul class="uiMenu uiSelectorMenu loading">'+'<li><span></span></li>'+'</ul>'+'</div>');DOM.appendContent(o.parentNode,w);Bootloader.loadComponents('async',function(){AsyncRequest.bootstrap(n,o);});p=e(r);}}if(p){Menu.register(p);if(k){var q=Menu.getCheckedItems(p);if(!q.length)q=Menu.getEnabledItems(p);Menu.focusItem(q[0]);}}}else{a=null;p&&Menu.unregister(p);k&&o.focus();if(l(r)&&DataStore.get(r,'dirty')){var t=DOM.scry(r,'input.submitButton')[0];t&&t.click();DataStore.remove(r,'dirty');}}CSS.conditionClass(d(r),'selected',s);Selector.inform(s?'open':'close',{selector:r});}});});return copy_properties(new Arbiter(),{attachMenu:function(q,m,o){q=b(q);if(q){a&&Menu.unregister(e(a));DOM.setContent(f(q),m);a&&Menu.register(e(q));if(o){var p=g(q);if(p){DOM.replace(p,o);}else DOM.insertAfter(q.firstChild,o);var n=q.getAttribute('data-name');n&&g(q).setAttribute('name',n);}return true;}},getOption:function(o,p){var n=Selector.getOptions(o),m=n.length;while(m--)if(p===Selector.getOptionValue(n[m]))return n[m];return null;},getOptions:function(n){var m=Menu.getItems(e(n));return m.filter(j);},getEnabledOptions:function(n){var m=Menu.getEnabledItems(e(n));return m.filter(j);},getSelectedOptions:function(m){return Menu.getCheckedItems(e(m));},getOptionText:function(m){return Menu.getItemLabel(m);},getOptionValue:function(n){var p=b(n);var o=g(p);var m=Selector.getOptions(p).indexOf(n);return m>=0?o.options[m+1].value:'';},getValue:function(q){var o=g(q);if(!o)return null;if(!i(q))return o.value;var r=[];var n=o.options;for(var m=1,p=n.length;m<p;m++)if(n[m].selected)r.push(n[m].value);return r;},isOptionSelected:function(m){return Menu.isItemChecked(m);},listen:function(n,o,m){return this.subscribe(o,function(q,p){if(p.selector===n)return m(p,q);});},setButtonLabel:function(p,n){var m=d(p);var o=parseInt(m.getAttribute('data-length'),10);n=n||m.getAttribute('data-label')||'';Button.setLabel(m,n);if(typeof n==='string'){CSS.conditionClass(m,'uiSelectorBigButtonLabel',n.length>o);if(o&&n.length>o){m.setAttribute('title',n);}else m.removeAttribute('title');}},setButtonTooltip:function(o,n){var m=d(o);TooltipLink.setTooltipText(m,n||m.getAttribute('data-tooltip')||'');},setEnabled:function(n,m){if(!m&&a&&b(n)===a)Selector.toggle(n);Button.setEnabled(d(n),m);},setOptionEnabled:function(n,m){Menu.setItemEnabled(n,m);},setSelected:function(q,r,o){o=o!==false;var n=Selector.getOption(q,r);if(!n)return;var m=Selector.isOptionSelected(n);if(o!==m){if(!i(q)&&!m){var p=Selector.getSelectedOptions(q)[0];p&&Menu.toggleItem(p);}Menu.toggleItem(n);Selector.updateSelector(q);}},toggle:function(m){Toggler.toggle(DOM.scry(b(m),'div.wrap')[0]);},updateSelector:function(v){var s=Selector.getOptions(v);var u=Selector.getSelectedOptions(v);var p=g(v).options;var r=[];for(var o=0,q=s.length;o<q;o++){var t=u.contains(s[o]);p[o+1].selected=t;if(t)r.push(Selector.getOptionText(s[o]));}p[0].selected=!u.length;var m=CSS.hasClass(v,'uiSelectorDynamicLabel');var n=CSS.hasClass(v,'uiSelectorDynamicTooltip');if(m||n){r=r.join(i(v)?d(v).getAttribute('data-delimiter'):'');m&&Selector.setButtonLabel(v,r);n&&Selector.setButtonTooltip(v,r);}}});}();
function DataSource(a){this.maxResults=10;this.queryData={};this.queryEndpoint='';this.bootstrapData={};this.bootstrapEndpoint='';this.indexedFields=['text'];this.exclusions=[];copy_properties(this,a);}DataSource.mixin('Arbiter',{events:['activity','query','respond'],init:function(){this.init=bagofholding;this._fields=Object.from(this.indexedFields);this.numResults=this.maxResults;this._activeQueries=0;this.dirty();},dirty:function(){this.value=this.flatValue='';this._bootstrapped=false;this.data={};this.localCache={};this.queryCache={};},bootstrap:function(){if(this._bootstrapped)return;this.fetch(this.bootstrapEndpoint,this.bootstrapData);this._bootstrapped=true;},query:function(f,c,a){this.inform('beforeQuery',{value:f});var b=TypeaheadUtil.flatten(f);var e=this.buildUids(b,[],a);var d=this.respond(f,e).filter(function(g){return g.type!='calltoaction';});this.value=f;this.flatValue=b;this.inform('query',{value:f,results:d});if(c||!b||!this.queryEndpoint||this.getQueryCache().hasOwnProperty(b)||!this.shouldFetchMoreResults(d))return false;this.inform('queryEndpoint',{value:f});this.fetch(this.queryEndpoint,this.getQueryData(f,e),{value:f,flat_value:b,exclusions:a});return true;},shouldFetchMoreResults:function(a){return a.length<this.numResults;},getQueryData:function(c,b){var a=copy_properties({value:c},this.queryData||{});b=b||[];if(b.length)a.existing_ids=b.join(',');return a;},setQueryData:function(a,b){if(b)this.queryData={};copy_properties(this.queryData,a);return this;},getExclusions:function(){return $A(this.exclusions);},setExclusions:function(a){this.exclusions=a||[];},setFilter:function(a){this.filter=a;},respond:function(d,c,a){var b=this.buildData(c);this.inform('respond',{value:d,results:b,isAsync:a});return b;},asyncErrorHandler:bagofholding,fetch:function(c,b,d){if(!c)return;var a=new AsyncRequest().setURI(c).setData(b).setMethod('GET').setReadOnly(true).setHandler(function(e){this.fetchHandler(e,d||{});}.bind(this)).setFinallyHandler(function(){this._activeQueries--;if(!this._activeQueries)this.inform('activity',{activity:false});}.bind(this));a.setErrorHandler(this.asyncErrorHandler);a.send();if(!this._activeQueries)this.inform('activity',{activity:true});this._activeQueries++;},fetchHandler:function(d,b){var e=b.value;var c=b.flat_value;var a=b.exclusions;this.addEntries(d.getPayload().entries,e,c);this.inform('fetchComplete',{response:d,value:e});this.respond(e,this.buildUids(c,[],a),true);},addEntries:function(b,f,c){var d=this.processEntries($A(b||[]),f);var a=this.buildUids(c,d);if(f){var e=this.getQueryCache();e[c]=a;}else this.fillCache(a);},processEntries:function(a,b){return a.map(function(d,c){var e=(d.uid=d.uid+'');if(this.data[e]){copy_properties(this.data[e],d);d=this.data[e];}else this.data[e]=d;if(d.index===undefined)d.index=c;d.query=b;return e;},this);},getEntry:function(a){return this.data[a]||null;},fillCache:function(b){var a=this.localCache;b.each(function(g){var d=this.data[g];if(!d||d.bootstrapped)return;d.bootstrapped=true;var f=this.getTokens(d);for(var c=0,e=f.length;c<e;++c){var h=f[c];if(!a.hasOwnProperty(h))a[h]=[];a[h].push(g);}},this);},getTokens:function(b){if(b.preparedTokens)return b.preparedTokens;var c=[];var d=b.tokens||[];for(var a in this._fields)c.push(b[a]||'');c=c.join(' ');return (b.preparedTokens=TypeaheadUtil.tokenize(c,d));},mergeUids:function(a,c,b,e){var d=function(f,g){return this.data[f].index-this.data[g].index;}.bind(this);return a.sort(d).concat(c,b);},buildUids:function(h,c,a){if(!c)c=[];if(!h)return c;if(!a)a=[];var f=TypeaheadUtil.tokenize(h,null,true);var b=this.buildCacheResults(f,this.localCache);var e=this.buildQueryResults(h,f);var d=this.mergeUids(b,e,c,f);var g=Object.from(a.concat(this.exclusions));return d.filter(function(i){if(g.hasOwnProperty(i))return false;if(this.filter&&!this.filter(this.data[i]))return false;return (g[i]=true);},this);},buildData:function(f){var d=[];var c=this.numResults;for(var b=0;b<f.length&&c;++b){var e=f[b];var a=this.data[e];if(a){d.push(a);c--;}}return d;},findQueryCache:function(e){var b=0;var a=null;var d=this.getQueryCache();for(var c in d)if(e.indexOf(c)==0&&c.length>b){b=c.length;a=c;}return d[a]||[];},buildQueryResults:function(c,b){var a=this.findQueryCache(c);if(this.getQueryCache().hasOwnProperty(c))return a;return this.filterQueryResults(b,a);},filterQueryResults:function(b,a){return a.filter(function(c){return TypeaheadUtil.isPrefixMatch(b,this.getTokens(this.data[c]));},this);},buildCacheResults:function(l,a){var j=l.length;var g={};var n={};var h=[];for(var e=0;e<j;++e){var k=l[e];for(var i in a)if(!g.hasOwnProperty(i)&&i.indexOf(k)===0){g[i]=true;var d=a[i];for(var f=0,c=d.length;f<c;++f){var m=d[f];if(e===0||(n.hasOwnProperty(m)&&n[m]==e))n[m]=e+1;}}}for(var b in n)if(n[b]==j)h.push(b);return h;},getQueryCache:function(){return this.queryCache;}});
function Typeahead(b,d,a,c){this.args={data:b,view:d,core:a};DataStore.set(c,'Typeahead',this);this.element=c;}Typeahead.getInstance=function(a){var b=Parent.byClass(a,'uiTypeahead');return b?DataStore.get(b,'Typeahead'):null;};Typeahead.mixin('Arbiter',{init:function(a){this.init=bagofholding;this.getCore();this.proxyEvents();this.initBehaviors(a||[]);this.inform('init',this);this.data.bootstrap();this.core.focus();},getData:function(){if(!this.data){var a=this.args.data;this.data=a;this.data.init();}return this.data;},getView:function(){if(!this.view){var a=this.args.view;this.view=new window[a.ctor](a.node,a.options||{});this.view.init();}return this.view;},getCore:function(){if(!this.core){var a=this.args.core;this.core=new window[a.ctor](a.options||{});this.core.init(this.getData(),this.getView(),this.getElement());}return this.core;},getElement:function(){return this.element;},swapData:function(b){var a=this.core;this.data=this.args.data=b;b.init();if(a){a.data=b;a.initData();a.reset();}b.bootstrap();return b;},proxyEvents:function(){[this.data,this.view,this.core].each(function(a){a.subscribe(a.events,this.inform.bind(this));},this);},initBehaviors:function(a){if(window.TypeaheadBehaviors)a.each(function(b){(TypeaheadBehaviors[b]||bagofholding)(this);},this);}});
function TypeaheadCore(a){copy_properties(this,a);}TypeaheadCore.mixin('Arbiter',{events:['blur','focus','reset','unselect'],keepFocused:true,resetOnSelect:false,setValueOnSelect:false,queryTimeout:250,preventFocusChangeOnTab:false,init:function(b,d,c){this.init=bagofholding;this.data=b;this.view=d;this.root=c;this.element=DOM.find(c,'.textInput');var a=DOM.scry(this.element,'input')[0];if(a)this.element=a;this.inputWrap=DOM.find(c,'div.wrap');this.hiddenInput=DOM.find(c,'input.hiddenInput');this.selectedText=null;if(this.setValueOnSelect&&CSS.hasClass(this.inputWrap,'selected'))this.selectedText=this.getValue();this.initView();this.initData();this.initEvents();this.initToggle();this._exclusions=[];},initView:function(){this.view.subscribe('highlight',function(){this.element.focus();}.bind(this));this.view.subscribe('select',function(a,b){this.select(b.selected);}.bind(this));this.view.subscribe('afterSelect',function(){this.afterSelect();}.bind(this));},initData:function(){this.data.subscribe('respond',function(a,b){if(b.value==this.getValue()&&!this.element.disabled)this.view.render(b.value,b.results,b.isAsync);}.bind(this));this.data.subscribe('activity',function(a,b){this.fetching=b.activity;if(!this.fetching)this.nextQuery&&this.performQuery();}.bind(this));},initEvents:function(){Event.listen(this.view.getElement(),{mouseup:this.viewMouseup.bind(this),mousedown:this.viewMousedown.bind(this)});var a={blur:bind(this,'blur'),focus:bind(this,'focus'),click:bind(this,'click'),keyup:bind(this,'keyup'),keydown:bind(this,'keydown')};if(ua.firefox())a.text=a.keyup;if(ua.firefox()<4){a.keypress=a.keydown;delete a.keydown;}Event.listen(this.element,a);Event.listen(this.element,'keypress',this.keypress.bind(this));},initToggle:function(){var b=this.root.parentNode;var d=CSS.getStyle(b,'position')!='static'?b:this.root;var c=this.view;var a='uiTypeaheadFocused';this.subscribe('focus',function(){c.show();CSS.addClass(d,a);});this.subscribe('blur',function(){c.hide();CSS.removeClass(d,a);});},viewMousedown:function(){this.selecting=true;},viewMouseup:function(){this.selecting=false;},blur:function(){if(this.selecting){this.selecting=false;return;}this.inform('blur');},click:function(){this.element.select();},focus:function(){this.checkValue();this.inform('focus');},keyup:function(){if(!this.getValue())this.view.reset();this.checkValue();},keydown:function(event){if(!this.view.isVisible()||this.view.isEmpty()){this.checkValue.bind(this).defer();return;}switch(Event.getKeyCode(event)){case KEYS.TAB:this.handleTab(event);return;case KEYS.UP:this.view.prev();break;case KEYS.DOWN:this.view.next();break;case KEYS.ESC:this.view.reset();break;default:this.checkValue.bind(this).defer();return;}event.kill();},keypress:function(event){if(this.view.getSelection()&&Event.getKeyCode(event)==KEYS.RETURN){this.view.select();event.kill();}},handleTab:function(event){this.view.select();this.preventFocusChangeOnTab&&event.kill();},select:function(a){if(a&&this.setValueOnSelect){this.setValue(a.text);this.setHiddenValue(a.uid);this.selectedText=a.text;CSS.addClass(this.inputWrap,'selected');}},afterSelect:function(){this.resetOnSelect?this.reset():this.view.reset();this.keepFocused?this.element.focus():this.element.blur();},unselect:function(){if(this.setValueOnSelect){this.selectedText=null;CSS.removeClass(this.inputWrap,'selected');}this.setHiddenValue();this.inform('unselect',this);},setEnabled:function(b){var a=b===false;this.element.disabled=a;CSS.conditionClass(this.root,'uiTypeaheadDisabled',a);},reset:function(){this.unselect();this.keepFocused?this.setValue():Input.reset(this.element);this.view.reset();this.inform('reset');},getElement:function(){return this.element;},setExclusions:function(a){this._exclusions=a;},getExclusions:function(){return this._exclusions;},setValue:function(a){this.value=this.nextQuery=a||'';Input.setValue(this.element,this.value);},setHiddenValue:function(a){this.hiddenInput.value=(a||a===0)?a:'';Arbiter.inform('Form/change',{node:this.hiddenInput});},getValue:function(){return Input.getValue(this.element);},getHiddenValue:function(){return this.hiddenInput.value||'';},checkValue:function(){var c=this.getValue();if(c==this.value)return;if(this.selectedText&&this.selectedText!=c)this.unselect();var b=+new Date();var a=b-this.time;this.time=b;this.nextQuery=this.value=c;this.performQuery(a);},performQuery:function(a){if(this.selectedText)return;a=a||0;if(this.fetching&&a<this.queryTimeout){this.data.query(this.nextQuery,true,this._exclusions);}else{this.data.query(this.nextQuery,false,this._exclusions);this.nextQuery=null;}}});
function TypeaheadAreaCore(a){this.parent.construct(this,a);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}TypeaheadAreaCore.extend('TypeaheadCore');TypeaheadAreaCore.prototype={prefix:'',suffix:', ',matcher:"\\b[^,]*",click:bagofholding,select:function(a){this.parent.select(a);var e=this.element.value;var d=this.prefix+a.text+this.suffix;this.expandBounds(e,d);var b=e.substring(0,this.start);var c=e.substring(this.end);this.element.value=b+d+c;FormControl.setCaretPosition(this.element,b.length+d.length);},expandBounds:function(d,c){d=d.toLowerCase();c=c.toLowerCase();var a,b;a=this.start;b=d.substring(this.start,this.end);while(a>=0&&c.indexOf(b)>=0){this.start=a--;b=d.charAt(a)+b;}a=this.end;b=d.substring(this.start,this.end);while(a<=d.length&&c.indexOf(b)>=0){b=b+d.charAt(a);this.end=a++;}this.start+=(b.length-b.trim().length);},getRawValue:function(){var b=this.parent.getValue();if(b==this.value)return b;var a=FormControl.getCaretPosition(this.element).start||0;return b.substring(0,a);},getValue:function(){var a=this.matcher&&this.matcher.exec(this.getRawValue());if(!a)return '';this.start=a.index;this.end=a.index+a[0].length;return a[1]||a[0];}};
function TypeaheadView(a,b){this.element=$(a);copy_properties(this,b);}TypeaheadView.mixin('Arbiter',{events:['highlight','render','reset','select'],renderer:'basic',autoSelect:false,init:function(){this.init=bagofholding;this.initializeEvents();this.reset();},initializeEvents:function(){Event.listen(this.element,{mouseup:this.mouseup.bind(this),mouseover:this.mouseover.bind(this)});},getElement:function(){return this.element;},mouseup:function(event){this.select(true);event.kill();},mouseover:function(event){if(this.visible)this.highlight(this.getIndex(event));},reset:function(a){if(!a)this.disableAutoSelect=false;this.index=-1;this.items=[];this.results=[];this.value='';this.element.innerHTML='';this.inform('reset');return this;},getIndex:function(event){return this.items.indexOf(Parent.byTag(event.getTarget(),'li'));},getSelection:function(){var a=this.results[this.index]||null;return this.visible?a:null;},isEmpty:function(){return !this.results.length;},isVisible:function(){return this.visible;},show:function(){CSS.show(this.element);this.visible=true;return this;},hide:function(){CSS.hide(this.element);this.visible=false;return this;},render:function(g,d,e){this.value=g;if(!d.length){this.reset(true);return;}this.inform('beforeRender',{results:d});var c=this.getDefaultIndex(d);if(this.index>0&&this.index!==this.getDefaultIndex(this.results)){var a=this.results[this.index];for(var b=0,f=d.length;b<f;++b)if(a.uid==d[b].uid){c=b;break;}}this.results=d;this.element.innerHTML=this.buildMarkup(d);this.items=this.getItems();this.highlight(c,false);this.inform('render',d);},getItems:function(){return DOM.scry(this.element,'li');},buildMarkup:function(c){var b,a=[];if(typeof this.renderer=="function"){a.push('<ul>');b=this.renderer;}else{a.push('<ul class="'+this.renderer+'">');b=TypeaheadRenderers[this.renderer];}c.each(function(d,e){a=a.concat(b(d,e));});a.push('</ul>');return a.join('');},getDefaultIndex:function(b){var a=(this.autoSelect&&!this.disableAutoSelect);return this.index<0&&!a?-1:0;},next:function(){this.highlight(this.index+1);},prev:function(){this.highlight(this.index-1);},highlight:function(a,b){this.selected&&CSS.removeClass(this.selected,'selected');if(a>this.items.length-1){a=-1;}else if(a<-1)a=this.items.length-1;if(a>=0&&a<this.items.length){this.selected=this.items[a];CSS.addClass(this.selected,'selected');}this.index=a;this.disableAutoSelect=(a==-1);if(b!==false)this.inform('highlight',{index:a,selected:this.results[a]});},select:function(a){var b=this.index,c=this.results[b];if(c){this.inform('select',{index:b,clicked:!!a,selected:c});this.inform('afterSelect');}}});
add_properties('TypeaheadRenderers',{compact:function(c,e){var h=c.markup||htmlize(c.text),g=htmlize(c.subtext),a=htmlize(c.category),f=c.photo,b='',d=[];if(f)if(f instanceof Array){d=['<span class="splitpics clearfix">','<span class="splitpic leftpic">','<img src="',f[0],'" alt="" />','</span>','<span class="splitpic">','<img src="',f[1],'" alt="" />','</span>','</span>'];}else d=['<img src="',f,'" alt="" />'];if(c.type)b=' class="'+c.type+'"';return ['<li',b,'>',d.join(''),(h?'<span class="text">'+h+'</span>':''),'<div class="details"><span class="detailsContents">',(a?a:''),(g&&a?' &middot ':''),(g?g:''),'</span></div>','</li>'];}});